# Server Configuration
SERVER_ADDR=:8080
BASE_URL=http://localhost:8080

# Security
JWT_SECRET=your-256-bit-secret-change-in-production
SESSION_SECRET=session-secret-change-in-production

# Database
DATABASE_DRIVER=sqlite
DATABASE_DSN=oauth.db

# PostgreSQL Example (uncomment to use):
# For local development/testing only (no TLS):
# DATABASE_DRIVER=postgres
# DATABASE_DSN="host=localhost user=authgate password=secret dbname=authgate port=5432 sslmode=disable"

# For production, enable TLS (example uses sslmode=require; configure certificates as needed):
# DATABASE_DRIVER=postgres
# DATABASE_DSN="host=your-prod-host user=authgate password=change-me dbname=authgate port=5432 sslmode=require"
# DATABASE_DSN="host=db.example.com user=authgate password=change-me dbname=authgate port=5432 sslmode=verify-full sslrootcert=/path/to/root.crt"

# Authentication Mode
# Options: local, http_api
# Default: local
AUTH_MODE=local

# HTTP API Authentication (when AUTH_MODE=http_api)
HTTP_API_URL=https://auth.example.com/api/verify
HTTP_API_TIMEOUT=10s
HTTP_API_INSECURE_SKIP_VERIFY=false

# HTTP API Retry Configuration
# Automatic retry with exponential backoff for failed requests
HTTP_API_MAX_RETRIES=3           # Maximum retry attempts (default: 3, set 0 to disable)
HTTP_API_RETRY_DELAY=1s          # Initial retry delay (default: 1s)
HTTP_API_MAX_RETRY_DELAY=10s     # Maximum retry delay (default: 10s)

# Token Provider Mode
# Options: local, http_api
# Default: local
TOKEN_PROVIDER_MODE=local

# HTTP API Token Provider (when TOKEN_PROVIDER_MODE=http_api)
# External token service will handle JWT generation and validation
TOKEN_API_URL=https://token.example.com/api
TOKEN_API_TIMEOUT=10s
TOKEN_API_INSECURE_SKIP_VERIFY=false

# Token API Retry Configuration
# Automatic retry with exponential backoff for failed requests
TOKEN_API_MAX_RETRIES=3          # Maximum retry attempts (default: 3, set 0 to disable)
TOKEN_API_RETRY_DELAY=1s         # Initial retry delay (default: 1s)
TOKEN_API_MAX_RETRY_DELAY=10s    # Maximum retry delay (default: 10s)

# OAuth Configuration
# GitHub OAuth (optional)
GITHUB_OAUTH_ENABLED=false
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
GITHUB_REDIRECT_URL=http://localhost:8080/auth/callback/github
GITHUB_SCOPES=user:email

# Gitea OAuth (optional)
GITEA_OAUTH_ENABLED=false
GITEA_URL=https://gitea.example.com
GITEA_CLIENT_ID=your_gitea_client_id
GITEA_CLIENT_SECRET=your_gitea_client_secret
GITEA_REDIRECT_URL=http://localhost:8080/auth/callback/gitea
GITEA_SCOPES=read:user

# Microsoft Entra ID (Azure AD) OAuth (optional)
MICROSOFT_OAUTH_ENABLED=false
MICROSOFT_TENANT_ID=common
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=
MICROSOFT_REDIRECT_URL=http://localhost:8080/auth/callback/microsoft
MICROSOFT_SCOPES=openid,profile,email,User.Read

# OAuth Settings
OAUTH_AUTO_REGISTER=true         # Allow OAuth to auto-create accounts (default: true)
OAUTH_TIMEOUT=15s                # HTTP client timeout for OAuth requests (default: 15s)
OAUTH_INSECURE_SKIP_VERIFY=false # Skip TLS verification for OAuth (dev/testing only, default: false)

# Rate Limiting
# Protect against brute force attacks and API abuse
ENABLE_RATE_LIMIT=true                  # Enable rate limiting (default: true)
RATE_LIMIT_STORE=memory                 # Store type: "memory" (single instance) or "redis" (multi-pod)
RATE_LIMIT_CLEANUP_INTERVAL=5m          # How often to cleanup old rate limiters (default: 5m)

# Redis Configuration (only used when RATE_LIMIT_STORE=redis)
# For multi-pod deployments, Redis provides shared rate limiting state
REDIS_ADDR=localhost:6379               # Redis server address
REDIS_PASSWORD=                         # Redis password (leave empty for no auth)
REDIS_DB=0                              # Redis database number (default: 0)

# Login endpoint rate limiting
LOGIN_RATE_LIMIT=5                      # Requests per minute for /login (default: 5)
LOGIN_RATE_LIMIT_BURST=2                # Burst size for /login (default: 2, ignored for redis)

# Device authorization code endpoint
DEVICE_CODE_RATE_LIMIT=10               # Requests per minute for /oauth/device/code (default: 10)
DEVICE_CODE_RATE_LIMIT_BURST=3          # Burst size for device code (default: 3, ignored for redis)

# Token exchange endpoint (includes polling)
TOKEN_RATE_LIMIT=20                     # Requests per minute for /oauth/token (default: 20)
TOKEN_RATE_LIMIT_BURST=5                # Burst size for token endpoint (default: 5, ignored for redis)

# Device verification endpoint
DEVICE_VERIFY_RATE_LIMIT=10             # Requests per minute for /device/verify (default: 10)
DEVICE_VERIFY_RATE_LIMIT_BURST=3        # Burst size for device verify (default: 3, ignored for redis)
